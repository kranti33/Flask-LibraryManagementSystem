{% extends "base.html" %}
{% block content %}
<div class="container mt-5">

    <div class="row">

        <!-- Sidebar Navigation -->
        <div class="col-md-3 mb-4">
            <div class="list-group" id="profile-tabs" role="tablist">
                <a class="list-group-item list-group-item-action active" id="info-tab" data-bs-toggle="list" href="#info" role="tab">Profile Info</a>
                <a class="list-group-item list-group-item-action" id="borrowed-tab" data-bs-toggle="list" href="#borrowed" role="tab">Borrowed Books</a>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="col-md-9">
            <div class="tab-content">

                <!-- Profile Info Tab -->
                <div class="tab-pane fade show active" id="info" role="tabpanel">
                    <div class="card p-4 shadow-sm">
                        <h3>Profile Info</h3>
                        <p><strong>Name:</strong> {{ current_user.name }}</p>
                        <p><strong>Email:</strong> {{ current_user.email }}</p>

                        <form method="POST" class="mt-3">
                            <label class="form-label">Change Password</label>
                            <input type="password" name="new_password" class="form-control mb-3" placeholder="••••••••">
                            <button class="btn btn-warning">Update Password</button>
                        </form>
                    </div>
                </div>

                <!-- Borrowed Books Tab -->
                <div class="tab-pane fade" id="borrowed" role="tabpanel">
                    {% if borrowed_books %}
                        <div class="books-slider">
                            {% set pastel = ['pastel-1','pastel-2','pastel-3','pastel-4'] %}
                            {% for borrow in borrowed_books %}
                            <div class="book-card {{ pastel[loop.index0 % 4] }}">

                                <div class="availability-badge {% if borrow.due_date and borrow.due_date < datetime.utcnow() %}unavailable{% else %}available{% endif %}"></div>

                                <img src="{{ url_for('static', filename='images/books/' + borrow.book.cover_image) }}" alt="{{ borrow.book.title }}">

                                <h5 class="book-title">{{ borrow.book.title }}</h5>
                                <div class="book-author">{{ borrow.book.author }}</div>
                                <div class="book-genre">{{ borrow.book.genre }}</div>

                                <p class="mt-2">
                                    <strong>Borrowed:</strong> {{ borrow.borrow_date.strftime('%Y-%m-%d') if borrow.borrow_date else "N/A" }} <br>
                                    <strong>Due:</strong> {{ borrow.due_date.strftime('%Y-%m-%d') if borrow.due_date else "N/A" }}
                                </p>

                                <form method="POST" action="{{ url_for('main.return_book', borrow_id=borrow.book.id) }}">
                                    <button type="submit" class="borrow-btn w-100">Return Book</button>
                                </form>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-center mt-4">You haven’t borrowed any books yet.</p>
                    {% endif %}
                </div>

            </div>
        </div>

    </div>

</div>

<!-- Slider Styles -->
<style>
.books-slider {
    display: flex;
    overflow-x: auto;
    gap: 20px;
    padding: 20px 0;
    scroll-behavior: smooth;
}

.books-slider::-webkit-scrollbar {
    height: 8px;
}

.books-slider::-webkit-scrollbar-thumb {
    background-color: rgba(0,0,0,0.3);
    border-radius: 4px;
}

.book-card {
    min-width: 200px;
    flex: 0 0 auto;
    text-align: center;
    border-radius: 15px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    position: relative;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    transition: transform 0.2s, box-shadow 0.2s;
}

.book-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

.book-card img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 10px;
}

.book-title {
    font-size: 16px;
    font-weight: 800;
    color: #1B3A57;
    margin: 5px 0;
}

.book-author {
    font-size: 14px;
    color: #333;
}

.book-genre {
    font-size: 12px;
    color: #555;
}

.borrow-btn {
    margin-top: 10px;
    font-weight: 700;
    background-color: #FF6F61;
    border: none;
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    transition: 0.2s;
}

.borrow-btn:hover {
    background-color: #E64A19;
}

/* Pastel colors */
.pastel-1 { background-color: #f9d5d3; }
.pastel-2 { background-color: #fef3c7; }
.pastel-3 { background-color: #d6f5d6; }
.pastel-4 { background-color: #d0f0fd; }

/* Availability badge */
.availability-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    border: 2px solid white;
}
.available { background-color: #28a745; }
.unavailable { background-color: #dc3545; }
</style>
{% endblock %}
